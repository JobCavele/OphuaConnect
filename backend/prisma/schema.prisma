generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url = "file:./dev.db"
}

// ========== ENUMS ==========

enum UserRole {
  SUPER_ADMIN
  COMPANY_ADMIN  
  EMPLOYEE
  PERSONAL
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  REVOKED
}

// ========== MODELOS PRINCIPAIS ==========

model User {
  id             String        @id @default(cuid())
  email          String        @unique
  passwordHash   String
  role           UserRole      @default(PERSONAL)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relações
  personalProfile   PersonalProfile?
  companyAdmin      CompanyAdmin?
  employeeProfile   EmployeeProfile?
  passwordResetTokens PasswordResetToken[]

  @@map("users")
}

model PersonalProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  fullName    String
  title       String?   // Ex: "Desenvolvedor Frontend", "Designer UX"
  bio         String?
  website     String?
  phone       String?
  socialLinks String?   // JSON: [{platform: "linkedin", url: "..."}]
  profileSlug String   @unique
  qrCodeUrl   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Tema personalizável
  themeSettingsId String? @unique
  themeSettings   ThemeSettings? @relation(fields: [themeSettingsId], references: [id])

  @@map("personal_profiles")
}

model Company {
  id          String   @id @default(cuid())
  name        String   @unique
  displayName String
  description String?
  website     String?
  logoUrl     String?
  phone       String?
  email       String?
  address     String?
  socialLinks String?   // JSON: [{platform: "instagram", url: "..."}]
  slug        String   @unique
  isVerified  Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relações
  admins      CompanyAdmin[]
  employees   EmployeeProfile[]
  invitations CompanyInvitation[]
  
  // Tema da empresa (cores do logo)
  themeSettingsId String @unique
  themeSettings   ThemeSettings @relation(fields: [themeSettingsId], references: [id])

  @@map("companies")
}

model CompanyAdmin {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId String
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Permissões específicas
  canManageEmployees Boolean @default(true)
  canEditCompanyInfo Boolean @default(true)
  canInviteAdmins    Boolean @default(false)
  canVerifyEmployees Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("company_admins")
}

model EmployeeProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id])
  
  fullName    String
  position    String     // Cargo
  department  String?
  employeeId  String?    // ID interno da empresa
  bio         String?
  phone       String?
  email       String?    // Email corporativo (pode ser diferente do user.email)
  socialLinks String?    // JSON: [{platform: "linkedin", url: "..."}]
  profileSlug String   @unique
  qrCodeUrl   String?
  
  // Status
  isApproved  Boolean  @default(false)  // Aprovado pelo admin da empresa
  isActive    Boolean  @default(true)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employee_profiles")
}

// ========== MODELOS DE SUPORTE ==========

model CompanyInvitation {
  id           String   @id @default(cuid())
  companyId    String
  company      Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  inviteToken  String   @unique
  inviteUrl    String   // URL completa: /invite/:token
  
  // Dados do convite
  email        String?    // Email convidado
  role         UserRole   @default(EMPLOYEE)
  invitedByName String?   // Quem convidou
  
  // Validade
  expiresAt    DateTime
  status       String     @default("PENDING") // PENDING, ACCEPTED, EXPIRED, REVOKED
  
  // Uso
  usedById     String?
  usedBy       User?      @relation(fields: [usedById], references: [id])
  usedAt       DateTime?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("company_invitations")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("password_reset_tokens")
}

model ThemeSettings {
  id              String   @id @default(cuid())
  
  // Cores principais (extraídas do logo ou personalizadas)
  primaryColor    String   @default("#3B82F6")   // Azul Tailwind
  secondaryColor  String   @default("#10B981")   // Verde
  accentColor     String   @default("#F59E0B")   // Âmbar
  backgroundColor String   @default("#FFFFFF")   // Branco
  textColor       String   @default("#1F2937")   // Cinza escuro
  
  // Metadados
  source          String?  // "logo", "custom", "default"
  logoColors      String?  // JSON com cores extraídas do logo

  // Relações (1:1 opcional)
  company         Company?
  personalProfile PersonalProfile?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("theme_settings")
}
