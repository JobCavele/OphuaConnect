generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int                @id @default(autoincrement())
  email            String             @unique
  password         String
  role             UserRole           @default(PERSONAL)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  
  personalProfile  PersonalProfile?
  employeeProfile  EmployeeProfile?
  companyAdmin     CompanyAdmin?
  
  passwordResetTokens PasswordResetToken[]
  
  @@map("users")
}

enum UserRole {
  PERSONAL
  EMPLOYEE
  COMPANY_ADMIN
  SUPER_ADMIN
}

model PersonalProfile {
  id              Int           @id @default(autoincrement())
  fullName        String
  phone           String?
  bio             String?
  avatarUrl       String?
  
  userId          Int           @unique
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  themeSettingsId Int           @unique
  themeSettings   ThemeSettings @relation(fields: [themeSettingsId], references: [id])
  
  socialLinks     Json?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@map("personal_profiles")
}

model Company {
  id              Int                @id @default(autoincrement())
  name            String
  slug            String?            @unique
  website         String?
  description     String?
  logoUrl         String?
  socialLinks     Json?
  
  themeSettingsId Int                @unique
  themeSettings   ThemeSettings      @relation(fields: [themeSettingsId], references: [id])
  
  admins          CompanyAdmin[]
  employees       EmployeeProfile[]
  invitations     CompanyInvitation[]
  
  status          CompanyStatus      @default(ACTIVE)
  
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  
  @@map("companies")
}

enum CompanyStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model CompanyAdmin {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@map("company_admins")
}

model EmployeeProfile {
  id              Int              @id @default(autoincrement())
  fullName        String
  position        String?
  phone           String?
  bio             String?
  avatarUrl       String?
  
  userId          Int              @unique
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyId       Int
  company         Company          @relation(fields: [companyId], references: [id])
  
  themeSettingsId Int              @unique
  themeSettings   ThemeSettings    @relation(fields: [themeSettingsId], references: [id])
  
  socialLinks     Json?
  status          EmployeeStatus   @default(PENDING)
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  @@map("employee_profiles")
}

enum EmployeeStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

model ThemeSettings {
  id             Int              @id @default(autoincrement())
  primaryColor   String           @default("#3B82F6")
  secondaryColor String           @default("#1E40AF")
  fontFamily     String           @default("Inter")
  
  personalProfile PersonalProfile?
  employeeProfile EmployeeProfile?
  company         Company?
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  @@map("theme_settings")
}

model CompanyInvitation {
  id          Int      @id @default(autoincrement())
  companyId   Int
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  token       String   @unique
  email       String?
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  
  @@map("company_invitations")
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@map("password_reset_tokens")
}